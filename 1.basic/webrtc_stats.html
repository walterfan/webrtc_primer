

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>WebRTC stats &mdash; webrtc_tutorial 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="视频聊天实例" href="video_chat.html" />
    <link rel="prev" title="WebRTC SDP" href="webrtc_sdp.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../outline.html">目录</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">1. WebRTC 基础</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">WebRTC 概论</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_spec.html">WebRTC 标准，协议和规范</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_api.html">WebRTC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_flow.html">WebRTC 呼叫流程</a></li>
<li class="toctree-l2"><a class="reference internal" href="media_device.html">Media Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="media_capture.html">WebRTC API 之 Media Capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="screen_capture.html">WebRTC API 之 Screen Capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="media_record.html">WebRTC API 之 Media Record</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_extension.html">WebRTC extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_signal.html">WebRTC 的信令</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_sdp.html">WebRTC SDP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WebRTC stats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transport-layer">传输层 transport layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#payload-layer">荷载层 payload layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">重要的是搞清楚状况</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#audio-inbound-rtp-audio-rtp">1) Audio Inbound-rtp 接收的 Audio RTP 数据度量</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audio-outbound-rtp-audio-rtp">2) Audio outbound-rtp 发送的 Audio RTP 数据度量</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video-inbound-rtp-video-rtp">3) Video Inbound-rtp 接收的 Video RTP 数据度量</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video-outbound-rtp-video-rtp">4) Video outbound-rtp 发送的 Video RTP 数据度量</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#webrtc-statistics-api">WebRTC statistics API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">全部的度量指标</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">度量驱动改进</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">参考资料</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video_chat.html">视频聊天实例</a></li>
<li class="toctree-l2"><a class="reference internal" href="html5.html">HTML5 for WebRTC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2.transport/index.html">2. WebRTC 传输</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.media/index.html">3. WebRTC 媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.tool/index.html">5. WebRTC 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6.misc/index.html">6. WebRTC 关联技术</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">1. WebRTC 基础</a> &raquo;</li>
        
      <li>WebRTC stats</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/1.basic/webrtc_stats.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="webrtc-stats">
<h1>WebRTC stats<a class="headerlink" href="#webrtc-stats" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>WebRTC Stats</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>WIP as draft</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2021-10-27</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id5">Overview</a></p></li>
<li><p><a class="reference internal" href="#transport-layer" id="id6">传输层 transport layer</a></p></li>
<li><p><a class="reference internal" href="#payload-layer" id="id7">荷载层 payload layer</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id8">重要的是搞清楚状况</a></p>
<ul>
<li><p><a class="reference internal" href="#audio-inbound-rtp-audio-rtp" id="id9">1) Audio Inbound-rtp 接收的 Audio RTP 数据度量</a></p></li>
<li><p><a class="reference internal" href="#audio-outbound-rtp-audio-rtp" id="id10">2) Audio outbound-rtp 发送的 Audio RTP 数据度量</a></p></li>
<li><p><a class="reference internal" href="#video-inbound-rtp-video-rtp" id="id11">3) Video Inbound-rtp 接收的 Video RTP 数据度量</a></p></li>
<li><p><a class="reference internal" href="#video-outbound-rtp-video-rtp" id="id12">4) Video outbound-rtp 发送的 Video RTP 数据度量</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#webrtc-statistics-api" id="id13">WebRTC statistics API</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id14">全部的度量指标</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id15">度量驱动改进</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id16">参考资料</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In WebRTC, the above metrics are wrapped as a stats object RTCStatsReport, which is an interface provides a statistics report obtained by calling one of the</p>
<ul class="simple">
<li><p>RTCPeerConnection.getStats()</p></li>
<li><p>RTCRtpReceiver.getStats()</p></li>
<li><p>RTCRtpSender.getStats()</p></li>
</ul>
<p>refer to <a class="reference external" href="https://www.w3.org/TR/webrtc-stats">https://www.w3.org/TR/webrtc-stats</a> for detailed definition of the above interface</p>
<p>Domain Object
RTCStatsReport
It is a dictionary that return by getStats method, which contains a mapping of statistic category string names to objects containing the corresponding statistics data.
refer to <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/RTCStatsReport">https://developer.mozilla.org/en-US/docs/Web/API/RTCStatsReport</a></p>
<p>All WebRTC statistics objects are fundamentally based on the RTCStats dictionary, the following categories will be implemented</p>
<ul class="simple">
<li><p>inbound-rtp</p></li>
<li><p>outbound-rtp</p></li>
<li><p>remote-inbound-rtp</p></li>
<li><p>candidate-pair</p></li>
</ul>
<img alt="../_images/webrtc_stats_class.png" src="../_images/webrtc_stats_class.png" />
</div>
<div class="section" id="transport-layer">
<h2><a class="toc-backref" href="#id6">传输层 transport layer</a><a class="headerlink" href="#transport-layer" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>latency</p></li>
<li><p>jitter</p></li>
<li><p>packet loss</p></li>
<li><p>bitrate</p></li>
<li><p>packetRate</p></li>
</ul>
</div>
<div class="section" id="payload-layer">
<h2><a class="toc-backref" href="#id7">荷载层 payload layer</a><a class="headerlink" href="#payload-layer" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Key frames</p></li>
<li><p>Concealment frames</p></li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id8">重要的是搞清楚状况</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>由于新冠疫情，我们待在家中，在网上工作，开会，看电影的时间越来越多了。网络嘛，大家都知道，时常不稳定，网上开会时声音听不清楚，图像模糊，视频有马赛克（不是人为打的）的情况时有发生，这时候，问题出在哪里呢？
也许是网络的问题，也许不是，即使网络出现问题，只要不是不可忍受的，我们依然需要进行调整，保证基本的功能：</p>
<ol class="arabic simple">
<li><p>语音通话要保持通畅，这是要首先保证的</p></li>
<li><p>共享的桌面或文件内容要能够识别</p></li>
<li><p>视频要能看到，哪怕分辨率低点也行</p></li>
</ol>
<p>首要的事情是要搞清楚出了什么问题？网络传输问题，设备问题，编解码的问题，还是音视频源的问题？</p>
<p>网络抓包后分析媒体流是常规的媒体质量分析方法，可是用户和服务器都不可能让你随时随地去抓包，何况还有安全和隐私问题的红线。所以剩下的选择就是度量
metrics, 做好度量就能见微知著，透过现象看本质，为上述问题找出答案。</p>
<p>先看一个例子 <a class="reference external" href="https://www.fanyamin.com/webrtc/examples/stats_demo.html">WebRTC Statistics Example</a>， 源码很简单，参见 *
<a class="reference external" href="https://github.com/walterfan/webrtc_primer/blob/main/examples/stats_demo.html">stats_demo.html</a> * <a class="reference external" href="https://github.com/walterfan/webrtc_primer/blob/main/examples/js/stats_demo.js">stats_demo.js</a></p>
<p>就是建立一个本地端到端的连接，将收集到的统计数据打印出来</p>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-61df76ebeb2dd752.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-61df76ebeb2dd752.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<div class="section" id="audio-inbound-rtp-audio-rtp">
<h3><a class="toc-backref" href="#id9">1) Audio Inbound-rtp 接收的 Audio RTP 数据度量</a><a class="headerlink" href="#audio-inbound-rtp-audio-rtp" title="Permalink to this headline">¶</a></h3>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-33252b250bd2bf2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-33252b250bd2bf2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p>注： * concealedSamples： 类型为 unsigned long long，
它只存在于音频中，指隐藏的(concealed)
的音频采样的总个数。一个隐藏的采样是指用本地合成的音频采样来替换收到的音频采样进行回放。它所隐藏的是丢失的包(度量指标为
packetsLoss)或者来得太迟的语音数据包(度量指标为packetsDiscarded)，尽量使得听者感知不到有丢包的情况</p>
<ul class="simple">
<li><p>silentConcealedSamples 类型为 unsigned long long
它只存在于音频中，指以静音包(slient)作为隐藏的(concealed)
的音频采样的总个数。静音包以静音或者舒适噪音进行播放，silentConcealedSamples是concealedSamples的子集</p></li>
<li><p>JitterBufferDelay: 类型为 double ,
单位为秒，抖动缓冲区的目的让子弹飞一会儿, 将收到的 RTP
数据包暂存一下, 等一会儿再将缓冲区的 RTP
包重新组合成帧或者重新排序并平滑播放。此处描述的模型假设样本或帧仍处于压缩状态且尚未解码。
它是每个音频样本或视频帧从抖动缓冲区接收到第一个数据包的时间（收取时间戳）到它退出抖动缓冲区的时间（发出时间戳）所用时间的总和。
在音频的情况下，多个样本属于同一个 RTP
数据包，因此它们将具有相同的摄取时间戳，但不同的抖动缓冲区发出时间戳。
在视频的情况下，帧可能是通过多个 RTP
数据包接收的，因此收取时间戳是进入抖动缓冲区的最早数据包，发出时间戳是整个帧退出抖动缓冲区的时间。该指标在样本或帧退出时增加，在缓冲区中完成它们的时间（并增加
jitterBufferEmittedCount）。 平均抖动缓冲延迟可以通过将
jitterBufferDelay 与 jitterBufferEmittedCount 相除来计算。</p></li>
<li><p>jitterBufferEmittedCount：类型为 unsigned long long
从抖动缓冲区中出来的音频样本或视频帧的总数</p></li>
<li><p>audioLevel 类型为double, 它代表媒体源的音频水平， 这个值位于 0 和 1
之间，这里的 1 代表 0 dBov, 0 代表静音，0.5 表示声压级从 0 dBov
开始大约 6 dBSPL 变化。</p></li>
</ul>
<p>注1：dB（SPL）表示 dB（声压级，sound pressure
level）意为在空气或其它气体中的声压，其参考值为20微帕斯卡
<span class="math notranslate nohighlight">\(（μP_a） = 2×10^{−5} P_a\)</span>，这是人能听到的最安静的声音。大致相当于3米外蚊子飞行的声音。经常被缩写为“dB”，这造成了很多误解以为“dB”是个有量纲的绝对单位。对于水声或其它液体，参考值是1
μPa。 dBov or dBO 意为 dB（过载，overload）–
信号的幅值，其参照于设备的最大在限幅（clipping）发生前的最大允许值。</p>
<p>注2：声压指声音的强度 $ L_p = 20 log_{10}(P_{rms}/P_{ref}) dB $,
单位是分贝，分贝是一个比值，分母 <span class="math notranslate nohighlight">\(P_{ref}\)</span> 是 20 微帕， 20
微帕是人耳所能听到的最低的声音强度。</p>
<ul class="simple">
<li><p>totalAudioEnergy：类型为 double ， 只存在于音频中。
它代表收到的音轨的音频能量。这个值计算方式如下:
每一个收到的音频采样(指标为 totalSamplesReceived) ,
将采样值加起来，并除以最高强度的编码值，再平方并乘以采样的时间(秒)。
换句话说，即 <code class="docutils literal notranslate"><span class="pre">duration</span> <span class="pre">*</span> <span class="pre">Math.pow(energy/maxEnergy,</span> <span class="pre">2)</span></code>。
它可以用来获取均方根 RMS(Root Mean Square), 使用与 RFC6464 定义的
audioLevel 的相同单位。</p></li>
</ul>
<p>可以如下公式来转换为这些单位
<code class="docutils literal notranslate"><span class="pre">Math.sqrt(totalAudioEnergy/totalSampleDuration)</span></code>,
而计算平均音频电平的公式为
<code class="docutils literal notranslate"><span class="pre">Math.sqrt((energy2</span> <span class="pre">-</span> <span class="pre">energy1)/(duration2</span> <span class="pre">-</span> <span class="pre">duration1))</span></code>。</p>
<p>例如， 如果生成一个 10ms 音频数据包， 其 RMS 为 0.5（超过 1.0）, 则将
<code class="docutils literal notranslate"><span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">0.01</span> <span class="pre">=</span> <span class="pre">0.0025</span></code> 加到 totalAudioEnengy, 如果另外一个 10ms
音频数据包，其 RMS 为 0.1，则添加 0.0001 到 totalAudioEnengy。
然后，<code class="docutils literal notranslate"><span class="pre">Math.sqrt(totalAudioEnergy/totalSamplesDuration)</span></code> 变为
<code class="docutils literal notranslate"><span class="pre">Math.sqrt(0.0026/0.02)</span> <span class="pre">=</span> <span class="pre">0.36</span></code>，这与通过对连续 20 毫秒音频段进行
RMS 计算获得的值相同。</p>
<p>如果使用多个音频通道，则样本的音频能量是指任一通道的最高能量。</p>
</div>
<div class="section" id="audio-outbound-rtp-audio-rtp">
<h3><a class="toc-backref" href="#id10">2) Audio outbound-rtp 发送的 Audio RTP 数据度量</a><a class="headerlink" href="#audio-outbound-rtp-audio-rtp" title="Permalink to this headline">¶</a></h3>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-53ca64d7d7435d8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-53ca64d7d7435d8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
</div>
<div class="section" id="video-inbound-rtp-video-rtp">
<h3><a class="toc-backref" href="#id11">3) Video Inbound-rtp 接收的 Video RTP 数据度量</a><a class="headerlink" href="#video-inbound-rtp-video-rtp" title="Permalink to this headline">¶</a></h3>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-fe0dc54aab574f58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-fe0dc54aab574f58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p>注： * totalDecodeTime:
花费在解码上的总时间(以秒为单位)，所解码的帧数可由 framesDecoded 得到 *
totalInterFrameDelay
连续解码的帧之间的帧间延迟总和（以秒为单位），在帧解码后立即记录。</p>
<p>可根据公式：(totalSquaredInterFrameDelay -
totalInterFrameDelay^2/framesDecoded)/framesDecoded，从totalInterFrameDelay、totalSquaredInterFrameDelay
和framesDecoded 计算帧间延迟方差。</p>
<ul class="simple">
<li><p>totalSquaredInterFrameDelay
连续解码的帧之间的平方帧间延迟的总和（以秒为单位）</p></li>
</ul>
</div>
<div class="section" id="video-outbound-rtp-video-rtp">
<h3><a class="toc-backref" href="#id12">4) Video outbound-rtp 发送的 Video RTP 数据度量</a><a class="headerlink" href="#video-outbound-rtp-video-rtp" title="Permalink to this headline">¶</a></h3>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-bef8d2bdf0fda02c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-bef8d2bdf0fda02c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
</div>
</div>
<div class="section" id="webrtc-statistics-api">
<h2><a class="toc-backref" href="#id13">WebRTC statistics API</a><a class="headerlink" href="#webrtc-statistics-api" title="Permalink to this headline">¶</a></h2>
<p>详细的 API 和数据结构定义参见
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/getStats">https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/getStats</a></p>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-bee7d7d33e4c0f14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-bee7d7d33e4c0f14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<ul class="simple">
<li><p>candidate-pair: refer to RTCIceCandidatePairStats.</p></li>
<li><p>inbound-rtp: refer to RTCInboundRtpStreamStats</p></li>
<li><p>outbound-rtp: refer to RTCOutboundRtpStreamStats</p></li>
<li><p>remote-inbound-rtp: refer to RTCRemoteInboundRtpStreamStats</p></li>
<li><p>remote-outbound-rtp: refer to RTCRemoteOutboundRtpStreamStats</p></li>
</ul>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-85a9cf2eb95afab3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-85a9cf2eb95afab3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id14">全部的度量指标</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>参见 <a class="reference external" href="https://www.w3.org/TR/webrtc-stats/#summary">https://www.w3.org/TR/webrtc-stats/#summary</a></p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id15">度量驱动改进</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>我们可以用各种工具来更改网络条件，例如延迟，丢包，抖动等，观察度量指标的变化.</p>
<p>以我常用的 macos 为例，可以安装 <a class="reference external" href="https://nshipster.com/network-link-conditioner/#installation">Network Link Cponditioner</a>
对本地发送接收的网络条件进行调整，再观察应用的度量指标。</p>
<p>这样在系统设置里可以看到 Network Link Conditioner 的图标</p>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-d32ba17291666f18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-d32ba17291666f18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p>然后点击 “Manage Profiles”, 对上行(uplink) 和下行 (downlink)
的带宽(bandwidth)，丢包(packet loss)， 延迟(delay) 进行调整：</p>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-1a09712691a1a79a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-1a09712691a1a79a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p>至于 windows ，我们可以使用 <a class="reference external" href="https://jagt.github.io/clumsy/index.html">Clumsy</a> 来更改网络参数, 下载地址有
<a class="reference external" href="https://jagt.github.io/clumsy/download.html">https://jagt.github.io/clumsy/download.html</a> Manual:
<a class="reference external" href="https://jagt.github.io/clumsy/manual.html">https://jagt.github.io/clumsy/manual.html</a>， 界面如下</p>
<img alt="https://upload-images.jianshu.io/upload_images/1598924-705ea68c6071d2e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" src="https://upload-images.jianshu.io/upload_images/1598924-705ea68c6071d2e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p>至于 Linux 服务器，可以使用 Linux Traffic Control 的 netem
模块来模拟网络异常, 例如想要在服务器上添加 200ms 的延迟</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">iproute</span>
<span class="n">tc</span> <span class="n">qdisc</span> <span class="n">add</span> <span class="n">dev</span> <span class="n">eth0</span> <span class="n">root</span> <span class="n">netem</span> <span class="n">delay</span> <span class="mi">200</span><span class="n">ms</span>
<span class="n">tc</span> <span class="n">qdisc</span> <span class="n">show</span>  <span class="n">dev</span> <span class="n">eth0</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id16">参考资料</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.w3.org/TR/webrtc-stats">https://www.w3.org/TR/webrtc-stats</a></p></li>
<li><p><a class="reference external" href="https://nshipster.com/network-link-conditioner/#installation">https://nshipster.com/network-link-conditioner/#installation</a></p></li>
<li><p><a class="reference external" href="https://www.linux.org/docs/man8/tc-netem.html">https://www.linux.org/docs/man8/tc-netem.html</a></p></li>
</ul>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/webrtc/webrtc-org/blob/gh-pages/experiments/rtp-hdrext/abs-capture-time/index.md">https://github.com/webrtc/webrtc-org/blob/gh-pages/experiments/rtp-hdrext/abs-capture-time/index.md</a></p></li>
<li><p><a class="reference external" href="https://github.com/w3c/webrtc-stats/issues/537">https://github.com/w3c/webrtc-stats/issues/537</a></p></li>
<li><p><a class="reference external" href="https://codereview.webrtc.org/2946413002/">https://codereview.webrtc.org/2946413002/</a></p></li>
<li><p><a class="reference external" href="https://webrtc.googlesource.com/src/+/refs/heads/master/docs/native-code/rtp-hdrext/video-timing">https://webrtc.googlesource.com/src/+/refs/heads/master/docs/native-code/rtp-hdrext/video-timing</a> <a class="reference external" href="https://github.com/w3ctag/design-reviews/issues/493">https://github.com/w3ctag/design-reviews/issues/493</a></p></li>
<li><p><a class="reference external" href="https://github.com/webrtc/samples/pull/27">https://github.com/webrtc/samples/pull/27</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="video_chat.html" class="btn btn-neutral float-right" title="视频聊天实例" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="webrtc_sdp.html" class="btn btn-neutral float-left" title="WebRTC SDP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, walter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>