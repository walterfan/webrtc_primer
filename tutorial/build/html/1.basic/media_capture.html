

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>WebRTC API 之 Media Capture &mdash; webrtc_tutorial 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WebRTC API 之 Screen Capture" href="screen_capture.html" />
    <link rel="prev" title="WebRTC 远程连接" href="remote_pc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../outline.html">目录</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">1. WebRTC 基础</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">WebRTC 概论</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_spec.html">WebRTC 标准，协议和规范</a></li>
<li class="toctree-l2"><a class="reference internal" href="local_pc.html">WebRTC 本地连接</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote_pc.html">WebRTC 远程连接</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WebRTC API 之 Media Capture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enumeratedevices">enumerateDevices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gum-getusermedia">GUM-getUserMedia</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">参考资料</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="screen_capture.html">WebRTC API 之 Screen Capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="media_record.html">WebRTC API 之 Media Record</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_signal.html">WebRTC 的信令</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_stats.html">WebRTC stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="video_chat.html">视频聊天实例</a></li>
<li class="toctree-l2"><a class="reference internal" href="html5.html">HTML5 for WebRTC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2.transport/index.html">2. WebRTC 传输</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.media/index.html">3. WebRTC 媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.tool/index.html">5. WebRTC 工具</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">1. WebRTC 基础</a> &raquo;</li>
        
      <li>WebRTC API 之 Media Capture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/1.basic/media_capture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="webrtc-api-media-capture">
<h1>WebRTC API 之 Media Capture<a class="headerlink" href="#webrtc-api-media-capture" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>Media Capture</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>WIP as draft</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2021-10-09</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#enumeratedevices" id="id3">enumerateDevices</a></p></li>
<li><p><a class="reference internal" href="#gum-getusermedia" id="id4">GUM-getUserMedia</a></p>
<ul>
<li><p><a class="reference internal" href="#example" id="id5">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id1" id="id6">参考资料</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>WebRTC（Web 实时通信）是一种技术，它使 Web 应用程序和站点能够捕获和可选地流式传输音频和/或视频媒体，以及在不需要中介的情况下在浏览器之间交换任意数据。 包含 WebRTC 的一组标准使得共享数据和执行点对点电话会议成为可能，而无需用户安装插件或任何其他第三方软件。</p>
<p>WebRTC 有多种用途；它们与 Media Capture 和 Streams API 一起为 Web 提供强大的多媒体功能，包括支持音频和视频会议、文件交换、屏幕共享、身份管理以及与传统电话系统的接口，包括支持发送 DTMF（按键拨号）信号。可以在不需要任何特殊驱动程序或插件的情况下建立对等点之间的连接，并且通常可以在没有任何中间服务器的情况下建立。</p>
<p>WebRTC 所提供的 API 可分为如下三大类</p>
<ol class="arabic simple">
<li><p>Media Capture and Streams API</p></li>
</ol>
<p>媒体流捕获相关的 API</p>
<p>媒体流可以由任意数量的媒体信息轨道组成；轨道由基于 MediaStreamTrack 接口的对象表示，可能包含多种类型的媒体数据之一，包括音频、视频和文本（例如字幕甚至章节名称）。大多数流至少包含一个音频轨道，可能还有一个视频轨道，可用于发送和接收实时媒体或存储的媒体信息（例如流媒体电影）。</p>
<ol class="arabic simple" start="2">
<li><p>RTCPeerConnection</p></li>
</ol>
<p>两个对等点之间的连接由 RTCPeerConnection 接口表示。一旦使用 RTCPeerConnection 建立并打开连接，就可以将媒体流 (MediaStreams) 和/或数据通道 (RTCDataChannels) 添加到连接中。</p>
<ol class="arabic simple" start="3">
<li><p>RTCDataChannel</p></li>
</ol>
<p>您还可以使用两个对等点之间的连接，使用 RTCDataChannel 接口交换任意二进制数据。这可用于反向通道信息、元数据交换、游戏状态数据包、文件传输，甚至可用作数据传输的主要通道。</p>
</div>
<div class="section" id="enumeratedevices">
<h2><a class="toc-backref" href="#id3">enumerateDevices</a><a class="headerlink" href="#enumeratedevices" title="Permalink to this headline">¶</a></h2>
<p>与媒体捕获和播放有关的设备有输入和输出设备之分</p>
<ol class="arabic simple">
<li><p>输入</p></li>
</ol>
<ul class="simple">
<li><p>video_input: Camera</p></li>
<li><p>audio_input: Mic</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>输出</p></li>
</ol>
<ul class="simple">
<li><p>audio_output: Speaker or headset</p></li>
</ul>
<p>接口原型为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Exposed</span><span class="o">=</span><span class="n">Window</span><span class="p">,</span> <span class="n">SecureContext</span><span class="p">]</span>
<span class="n">interface</span> <span class="n">MediaDevices</span> <span class="p">:</span> <span class="n">EventTarget</span> <span class="p">{</span>
    <span class="n">attribute</span> <span class="n">EventHandler</span> <span class="n">ondevicechange</span><span class="p">;</span>
    <span class="n">Promise</span><span class="o">&lt;</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">MediaDeviceInfo</span><span class="o">&gt;&gt;</span> <span class="n">enumerateDevices</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">[</span><span class="n">Exposed</span><span class="o">=</span><span class="n">Window</span><span class="p">,</span> <span class="n">SecureContext</span><span class="p">]</span>
<span class="n">interface</span> <span class="n">MediaDeviceInfo</span> <span class="p">{</span>
    <span class="n">readonly</span> <span class="n">attribute</span> <span class="n">DOMString</span> <span class="n">deviceId</span><span class="p">;</span>
    <span class="n">readonly</span> <span class="n">attribute</span> <span class="n">MediaDeviceKind</span> <span class="n">kind</span><span class="p">;</span>
    <span class="n">readonly</span> <span class="n">attribute</span> <span class="n">DOMString</span> <span class="n">label</span><span class="p">;</span>
    <span class="n">readonly</span> <span class="n">attribute</span> <span class="n">DOMString</span> <span class="n">groupId</span><span class="p">;</span>
    <span class="p">[</span><span class="n">Default</span><span class="p">]</span> <span class="nb">object</span> <span class="n">toJSON</span><span class="p">();</span>
<span class="p">};</span>

<span class="n">enum</span> <span class="n">MediaDeviceKind</span> <span class="p">{</span>
    <span class="s2">&quot;audioinput&quot;</span><span class="p">,</span>
    <span class="s2">&quot;audiooutput&quot;</span><span class="p">,</span>
    <span class="s2">&quot;videoinput&quot;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="gum-getusermedia">
<h2><a class="toc-backref" href="#id4">GUM-getUserMedia</a><a class="headerlink" href="#gum-getusermedia" title="Permalink to this headline">¶</a></h2>
<p>接口原型为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">partial</span> <span class="n">interface</span> <span class="n">MediaDevices</span> <span class="p">{</span>
    <span class="n">MediaTrackSupportedConstraints</span> <span class="n">getSupportedConstraints</span><span class="p">();</span>
    <span class="n">Promise</span><span class="o">&lt;</span><span class="n">MediaStream</span><span class="o">&gt;</span> <span class="n">getUserMedia</span><span class="p">(</span><span class="n">optional</span> <span class="n">MediaStreamConstraints</span> <span class="n">constraints</span> <span class="o">=</span> <span class="p">{});</span>
<span class="p">};</span>
</pre></div>
</div>
<p>输入参数为 MediaStreamConstraints</p>
<div class="highlight-WebIDL notranslate"><div class="highlight"><pre><span></span><span class="k">dictionary</span> <span class="nc">MediaStreamConstraints</span> <span class="p">{</span>
    <span class="p">(</span><span class="kt">boolean</span> <span class="k">or</span> <span class="nc">MediaTrackConstraints</span><span class="p">)</span> <span class="nv">video</span> <span class="p">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">boolean</span> <span class="k">or</span> <span class="nc">MediaTrackConstraints</span><span class="p">)</span> <span class="nv">audio</span> <span class="p">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">dictionary</span> <span class="nc">MediaTrackConstraints</span> <span class="p">:</span> <span class="nc">MediaTrackConstraintSet</span> <span class="p">{</span>
    <span class="kt">sequence</span><span class="p">&lt;</span><span class="nc">MediaTrackConstraintSet</span><span class="p">&gt;</span> <span class="nv">advanced</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">dictionary</span> <span class="nc">MediaTrackConstraintSet</span> <span class="p">{</span>
    <span class="nc">ConstrainULong</span> <span class="nv">width</span><span class="p">;</span>
    <span class="nc">ConstrainULong</span> <span class="nv">height</span><span class="p">;</span>
    <span class="nc">ConstrainDouble</span> <span class="nv">aspectRatio</span><span class="p">;</span>
    <span class="nc">ConstrainDouble</span> <span class="nv">frameRate</span><span class="p">;</span>
    <span class="nc">ConstrainDOMString</span> <span class="nv">facingMode</span><span class="p">;</span>
    <span class="nc">ConstrainDOMString</span> <span class="nv">resizeMode</span><span class="p">;</span>
    <span class="nc">ConstrainULong</span> <span class="nv">sampleRate</span><span class="p">;</span>
    <span class="nc">ConstrainULong</span> <span class="nv">sampleSize</span><span class="p">;</span>
    <span class="nc">ConstrainBoolean</span> <span class="nv">echoCancellation</span><span class="p">;</span>
    <span class="nc">ConstrainBoolean</span> <span class="nv">autoGainControl</span><span class="p">;</span>
    <span class="nc">ConstrainBoolean</span> <span class="nv">noiseSuppression</span><span class="p">;</span>
    <span class="nc">ConstrainDouble</span> <span class="nv">latency</span><span class="p">;</span>
    <span class="nc">ConstrainULong</span> <span class="nv">channelCount</span><span class="p">;</span>
    <span class="nc">ConstrainDOMString</span> <span class="nv">deviceId</span><span class="p">;</span>
    <span class="nc">ConstrainDOMString</span> <span class="nv">groupId</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>返回值是一个 Promise, 成功执行后返回 MediaStream</p>
<div class="highlight-WebIDL notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nd">Exposed</span><span class="p">=</span><span class="n">Window</span><span class="p">]</span>
<span class="k">interface</span> <span class="nc">MediaStream</span> <span class="p">:</span> <span class="nc">EventTarget</span> <span class="p">{</span>
    <span class="nc">constructor</span><span class="p">();</span>
    <span class="nc">constructor</span><span class="p">(</span><span class="nc">MediaStream</span> <span class="nv">stream</span><span class="p">);</span>
    <span class="nc">constructor</span><span class="p">(</span><span class="kt">sequence</span><span class="p">&lt;</span><span class="nc">MediaStreamTrack</span><span class="p">&gt;</span> <span class="nv">tracks</span><span class="p">);</span>
    <span class="k">readonly</span> <span class="k">attribute</span> <span class="kt">DOMString</span> <span class="nv">id</span><span class="p">;</span>
    <span class="kt">sequence</span><span class="p">&lt;</span><span class="nc">MediaStreamTrack</span><span class="p">&gt;</span> <span class="nf">getAudioTracks</span><span class="p">();</span>
    <span class="kt">sequence</span><span class="p">&lt;</span><span class="nc">MediaStreamTrack</span><span class="p">&gt;</span> <span class="nf">getVideoTracks</span><span class="p">();</span>
    <span class="kt">sequence</span><span class="p">&lt;</span><span class="nc">MediaStreamTrack</span><span class="p">&gt;</span> <span class="nf">getTracks</span><span class="p">();</span>
    <span class="nc">MediaStreamTrack</span><span class="p">?</span> <span class="nf">getTrackById</span><span class="p">(</span><span class="kt">DOMString</span> <span class="nv">trackId</span><span class="p">);</span>
    <span class="nc">undefined</span> <span class="nf">addTrack</span><span class="p">(</span><span class="nc">MediaStreamTrack</span> <span class="nv">track</span><span class="p">);</span>
    <span class="nc">undefined</span> <span class="nf">removeTrack</span><span class="p">(</span><span class="nc">MediaStreamTrack</span> <span class="nv">track</span><span class="p">);</span>
    <span class="nc">MediaStream</span> <span class="nf">clone</span><span class="p">();</span>
    <span class="k">readonly</span> <span class="k">attribute</span> <span class="kt">boolean</span> <span class="nv">active</span><span class="p">;</span>
    <span class="k">attribute</span> <span class="nc">EventHandler</span> <span class="nv">onaddtrack</span><span class="p">;</span>
    <span class="k">attribute</span> <span class="nc">EventHandler</span> <span class="nv">onremovetrack</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The MediaStreamTrack object represents media of a single type that originates from one media source in the User Agent, e.g. video produced by a web camera. A MediaStream is used to group several MediaStreamTrack objects into one unit that can be recorded or rendered in a media element.</p>
<p>Each MediaStream can contain zero or more MediaStreamTrack objects. All tracks in a MediaStream are intended to be synchronized when rendered. This is not a hard requirement, since it might not be possible to synchronize tracks from sources that have different clocks. Different MediaStream objects do not need to be synchronized.</p>
<div class="highlight-WebIDL notranslate"><div class="highlight"><pre><span></span>[Exposed=Window]
interface MediaStreamTrack : EventTarget {
    readonly attribute DOMString kind;
    readonly attribute DOMString id;
    readonly attribute DOMString label;
    attribute boolean enabled;
    readonly attribute boolean muted;
    attribute EventHandler onmute;
    attribute EventHandler onunmute;
    readonly attribute MediaStreamTrackState readyState;
    attribute EventHandler onended;
    MediaStreamTrack clone();
    undefined stop();
    MediaTrackCapabilities getCapabilities();
    MediaTrackConstraints getConstraints();
    MediaTrackSettings getSettings();
    Promise&lt;undefined&gt; applyConstraints(optional MediaTrackConstraints constraints = {});
};
</pre></div>
</div>
<div class="section" id="example">
<h3><a class="toc-backref" href="#id5">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Javascript notranslate"><div class="highlight"><pre><span></span>&lt;script&gt;
    const constraints = {
        video: {
           deviceId: localStorage.camId,
            width: {min: 640, ideal: 1280, max: 1280},
            height: {min: 480, ideal: 720},
            aspectRatio: 3/2,
            frameRate: {min: 20}
        },
        audio: {
            deviceId: localStorage.micId,
            channelCount: 2
        }
    };

    function handleSuccess(stream) {
        document.querySelector(&#39;video&#39;).srcObject = stream;
    }

    function handleError(error) {
        console.log(&#39;getUserMedia error: &#39;, error);
    }

    navigator.mediaDevices.getUserMedia(constraints)
            .then(handleSuccess)
            .catch(handleError);
&lt;/script&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id6">参考资料</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API">MDN WebRTC API</a></p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/mediacapture-streams">W3C Media Capture and Streams Spec</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="screen_capture.html" class="btn btn-neutral float-right" title="WebRTC API 之 Screen Capture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="remote_pc.html" class="btn btn-neutral float-left" title="WebRTC 远程连接" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, walter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>