

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>YUV 图像格式 &mdash; webrtc_tutorial 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="H.264 编码" href="h264.html" />
    <link rel="prev" title="视频编码" href="video_codec.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../outline.html">目录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1.basic/index.html">1. WebRTC 基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.transport/index.html">2. WebRTC 传输</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. WebRTC 媒体</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">WebRTC 媒体概论</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_audio.html">WebRTC 音频</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="webrtc_video.html">WebRTC 视频</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="video_basic.html">Video Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="video_codec.html">视频编码</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">YUV 图像格式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">图像格式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">YUV 图像的存储格式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rgb-yuv">RGB 与 YUV 格式的转换</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">代码示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">参考资料</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="h264.html">H.264 编码</a></li>
<li class="toctree-l3"><a class="reference internal" href="webrtc_video.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="webrtc_video.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_qos.html">WebRTC QoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_fec.html">WebRTC FEC</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_rtx.html">WebRTC RTX</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_rcc.html">WebRTC RTP Congestion Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="insertable_stream.html">Insertable Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_codec.html">Web Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_transport.html">Web Transport</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.tool/index.html">5. WebRTC 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6.misc/index.html">6. WebRTC 关联技术</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">3. WebRTC 媒体</a> &raquo;</li>
        
          <li><a href="webrtc_video.html">WebRTC 视频</a> &raquo;</li>
        
      <li>YUV 图像格式</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/3.media/yuv.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="yuv">
<h1>YUV 图像格式<a class="headerlink" href="#yuv" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>Video Basic</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>v1</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2021-11-03</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id9">图像格式</a></p>
<ul>
<li><p><a class="reference internal" href="#yuv-4-4-4" id="id10">YUV 4:4:4</a></p></li>
<li><p><a class="reference internal" href="#yuv-4-2-2" id="id11">YUV 4:2:2</a></p></li>
<li><p><a class="reference internal" href="#yuv-4-2-0" id="id12">YUV 4:2:0</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id2" id="id13">YUV 图像的存储格式</a></p></li>
<li><p><a class="reference internal" href="#rgb-yuv" id="id14">RGB 与 YUV 格式的转换</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id15">模拟电视</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id16">标清视频</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id17">高清视频</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id18">代码示例</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id19">参考资料</a></p></li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id9">图像格式</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>最简单的图像格式是 RGB24, 每个像素用24bits 来表示，三原色的每个颜色用 8
bits 来表示，如果还要表示像素的透明度，就再加 8 bits ，即 RGB32 格式</p>
<div class="figure align-default" id="id8">
<img alt="RGB" src="https://upload-images.jianshu.io/upload_images/1598924-7d5f228e1258459f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" />
<p class="caption"><span class="caption-text">RGB</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>这样一个 RGB24
图片可以用一个三维数组来表示，前两个维度表示图像的空间位置，最后一个维度表示颜色</p>
<p>YUV 则是另一种格式，Y 表示亮度，U 表示色度，V 表示浓度, 按照公式，可以把
RGB 转换成 YUV 格式</p>
<p>YCbCr 其实是 YUV 经过缩放和偏移的翻版。其中 Y 与 YUV 中的 Y
含义一致,Cb,Cr 同样都指色彩，只是在表示方法上不同而已。YCbCr 其中 Y
是指亮度分量，Cb 指蓝色色度分量，而 Cr 指红色色度分量。</p>
<p>常用的格式有</p>
<ul class="simple">
<li><p>YUV 4:4:4采样，每一个Y对应一组UV分量。</p></li>
<li><p>YUV 4:2:2采样，每两个Y共用一组UV分量。</p></li>
<li><p>YUV 4:2:0采样，每四个Y共用一组UV分量。</p></li>
</ul>
<p>如图所示</p>
<p><img alt="image0" src="https://upload-images.jianshu.io/upload_images/1598924-11d7a13f9887781e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p>在 YUV 格式的图像中，以实心圆代表 Y 分量， 空心圆代表 U 或 V
分量，其采样如下</p>
<p><img alt="image1" src="https://upload-images.jianshu.io/upload_images/1598924-46d2bce7bb45abd4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p>下面详细说说</p>
<div class="section" id="yuv-4-4-4">
<h3><a class="toc-backref" href="#id10">YUV 4:4:4</a><a class="headerlink" href="#yuv-4-4-4" title="Permalink to this headline">¶</a></h3>
<p>YUV 4:4:4 表示 Y、U、V
三分量采样率相同，即每个像素的三分量信息完整，都是 8bit，每个像素占用 3
个字节。</p>
<ul class="simple">
<li><p>四个像素为： [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]</p></li>
<li><p>采样的码流为： Y0 U0 V0 Y1 U1 V1 Y2 U2 V2 Y3 U3 V3</p></li>
<li><p>映射出的像素点为：[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]</p></li>
</ul>
</div>
<div class="section" id="yuv-4-2-2">
<h3><a class="toc-backref" href="#id11">YUV 4:2:2</a><a class="headerlink" href="#yuv-4-2-2" title="Permalink to this headline">¶</a></h3>
<p>YUV 4:2:2 表示 UV 分量的采样率是 Y 分量的一半</p>
<ul class="simple">
<li><p>四个像素为： [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]</p></li>
<li><p>采样的码流为： Y0 U0 Y1 V1 Y2 U2 Y3 V3</p></li>
<li><p>映射出的像素点为：[Y0 U0 V1]、[Y1 U0 V1]、[Y2 U2 V3]、[Y3 U2 V3]</p></li>
</ul>
</div>
<div class="section" id="yuv-4-2-0">
<h3><a class="toc-backref" href="#id12">YUV 4:2:0</a><a class="headerlink" href="#yuv-4-2-0" title="Permalink to this headline">¶</a></h3>
<p>YUV4:2:0并不是说只有U,
V一定为0，而是指U：V互相援引，时见时隐，也就是说对于每一个行，只有一个U或者V分量，如果一行是4:2:0的话，下一行就是4:0:2，再下一行是4:2:0…以此类推。</p>
<ul class="simple">
<li><p>8 个 图像像素为：8 * 3 = 24 个 bytes</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[Y0 U0 V0]、[Y1 U1 V1]、 [Y2 U2 V2]、 [Y3 U3 V3]
[Y4 U4 V4]、[Y5 U5 V5]、 [Y6 U6 V6] 、[Y7 U7 V7]
</pre></div>
</div>
<ul class="simple">
<li><p>采样的码流为：8(Y) + 2(U) + 2(V) = 12 个 bytes， 一下子就压缩了一半</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Y0</span> <span class="n">U0</span> <span class="n">Y1</span> <span class="n">Y2</span> <span class="n">U2</span> <span class="n">Y3</span>
<span class="n">Y4</span> <span class="n">V4</span> <span class="n">Y5</span> <span class="n">Y6</span> <span class="n">V6</span> <span class="n">Y7</span>
</pre></div>
</div>
<ul class="simple">
<li><p>映射出的像素点为：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[Y0 U0 V4]、[Y1 U0 V4]、[Y2 U2 V6]、[Y3 U2 V6]
[Y4 U0 V4]、[Y5 U0 V4]、[Y6 U2 V6]、[Y7 U2 V6]
</pre></div>
</div>
<p>即 Y0, Y1, Y4, Y5 共用 U0, V4 而 Y2, Y3, Y6, Y7 共用 U2, V6</p>
</div>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id13">YUV 图像的存储格式</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>YUV 的存储格式有以下三种</p>
<ol class="arabic simple">
<li><p>紧缩格式 Packed (or 交织格式)</p></li>
<li><p>平面格式 Planar (这种格式的名称常带着字母 “p”)</p></li>
<li><p>半平面格式 Semi-planar (这种格式的名称常带着字母 “sp”)</p></li>
</ol>
<p>不同的存储格式定义了在内存中的YUV分量的排列顺序</p>
<ul class="simple">
<li><p>紧缩格式（packed）：每个像素点的Y、U、V交替存储，Y1U1V1…YnUnVn。</p></li>
<li><p>平面格式（planar）：先存储所有像素的Y，再存储所有像素点U或者V，最后存储V或者U。其中U、V分别连续存储：Y1…Yn
U1…Un V1…Vn 或者 Y1…Yn V1…Vn U1…Un。</p></li>
<li><p>半平面格式（semi-planar）：先存储所有像素的Y，再存储所有像素点UV或者VU。其中U、V交替存储：Y1…Yn
U1V1…UnVn 或者 Y1…Yn V1U1…VnUn。</p></li>
</ul>
<p>从 YUV420P 的名字就可以看出它是 planar
平面格式，根据U和V顺序不同又分为：</p>
<ol class="arabic simple">
<li><p>YV12：Y1…Y4n V1…Vn U1…Un (例如：YYYYYYYYVVUU)</p></li>
<li><p>I420： Y1…Y4n U1…Un V1…Vn (例如：YYYYYYYYUUVV)</p></li>
</ol>
<p>一般说的 YUV420p就是指 I420</p>
<p>从 YUV420SP 的名字就可以看出它是 Semi-planar 半平面格式</p>
<ol class="arabic simple">
<li><p>NV21</p></li>
<li><p>NV12</p></li>
</ol>
<p>一般说的 YUV420sp就是指 NV12</p>
<p>引用一张图来表示</p>
<p><img alt="image2" src="https://upload-images.jianshu.io/upload_images/1598924-a62b634417b96910.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p>常用的图像文件</p>
<ul class="simple">
<li><p>BMP: 使用 RGB24 或 RGB32, 存储顺序为 BGR 或 BGRA</p></li>
<li><p>JPG: 就是使用 YUV 并进行 DCT 变换及压缩</p></li>
</ul>
</div>
<div class="section" id="rgb-yuv">
<h2><a class="toc-backref" href="#id14">RGB 与 YUV 格式的转换</a><a class="headerlink" href="#rgb-yuv" title="Permalink to this headline">¶</a></h2>
<p>计算公式如下</p>
<p><span class="math notranslate nohighlight">\(Y = k_rR + k_gG + k_bB\)</span></p>
<p><span class="math notranslate nohighlight">\(U = \frac{B - Y}{2(1-k_b)}\)</span></p>
<p><span class="math notranslate nohighlight">\(V = \frac{R - Y}{2(1-k_r)}\)</span></p>
<p>其中的相关系统，ITU-R 给出的推荐值为</p>
<p><span class="math notranslate nohighlight">\(k_r=0.299\)</span></p>
<p><span class="math notranslate nohighlight">\(k_g=0.587\)</span></p>
<p><span class="math notranslate nohighlight">\(k_b=0.114\)</span></p>
<p>以矩阵计算的方式表示 RGB 转为 YUV 的公式如下</p>
<p><span class="math notranslate nohighlight">\(\left [ \begin{matrix} Y \\ U \\ V \\ \end{matrix} \right ] = \left [ \begin{matrix} 0 \\ 128 \\ 128 \\ \end{matrix} \right ] + \left [ \begin{matrix} 0.299 &amp;&amp; 0.5870 &amp;&amp; 0.1140 \\ -0.1687 &amp;&amp; -0.3313 &amp;&amp; -0.5000 \\ 0.5000 &amp;&amp; -0.4187 &amp;&amp; -0.0813 \\ \end{matrix} \right ] * \left [ \begin{matrix} R \\ G \\ B \\ \end{matrix} \right ]\)</span></p>
<p>在实际应用中，针对不同的场景和清晰度要求，上述公式会有细微调整</p>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id15">模拟电视</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>传统上说的 YUV 是用于模拟电视的色彩表示，它与 RGB 之间的转换公式如下</p>
<p><img alt="image3" src="https://upload-images.jianshu.io/upload_images/1598924-48c460a4d0f8c9aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p><img alt="image4" src="https://upload-images.jianshu.io/upload_images/1598924-41d1325a0488c34a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id16">标清视频</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>对于数字视频，使用颜色格式 YCbCr。 对于标清电视应用
(SDTV)，以下等式描述了从 RGB 到 YCbCr 的颜色转换（根据 ITU-R BT.601）：</p>
<p><img alt="image5" src="https://upload-images.jianshu.io/upload_images/1598924-d8df4c6fd063149c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p><img alt="image6" src="https://upload-images.jianshu.io/upload_images/1598924-499f58b2856a0b1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p>对于使用 RGB 和 YCbCr
颜色格式的基于计算机的应用程序，色度和亮度值的可能范围保留了一些头部和足部的空间，这是为避免过冲提供一些空间所必需的。</p>
<p>如果要使用 8 位的完整可能范围，则不提供足部空间或动态余量。
通常，这种全范围颜色格式用于 JPEG 图像。</p>
<p>RGB 颜色到全范围 YCbCr 颜色的转换由以下等式描述：</p>
<p><img alt="image7" src="https://upload-images.jianshu.io/upload_images/1598924-0152b7893f53cefc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p><img alt="image8" src="https://upload-images.jianshu.io/upload_images/1598924-da39dd2a01223cbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id17">高清视频</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>对于高清电视应用 (HDTV)，转换系数以有所不同：</p>
<p><img alt="image9" src="https://upload-images.jianshu.io/upload_images/1598924-b4344c2934683b07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
<p><img alt="image10" src="https://upload-images.jianshu.io/upload_images/1598924-09d3978175cc27ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" /></p>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id18">代码示例</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">rgb2yuv</span><span class="p">(</span><span class="n">double</span><span class="o">&amp;</span> <span class="n">Y</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">U</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">V</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">R</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">G</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">B</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Y</span> <span class="o">=</span>  <span class="mf">0.257</span> <span class="o">*</span> <span class="n">R</span> <span class="o">+</span> <span class="mf">0.504</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="mf">0.098</span> <span class="o">*</span> <span class="n">B</span> <span class="o">+</span>  <span class="mi">16</span><span class="p">;</span>
  <span class="n">U</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.148</span> <span class="o">*</span> <span class="n">R</span> <span class="o">-</span> <span class="mf">0.291</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="mf">0.439</span> <span class="o">*</span> <span class="n">B</span> <span class="o">+</span> <span class="mi">128</span><span class="p">;</span>
  <span class="n">V</span> <span class="o">=</span>  <span class="mf">0.439</span> <span class="o">*</span> <span class="n">R</span> <span class="o">-</span> <span class="mf">0.368</span> <span class="o">*</span> <span class="n">G</span> <span class="o">-</span> <span class="mf">0.071</span> <span class="o">*</span> <span class="n">B</span> <span class="o">+</span> <span class="mi">128</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">yuv2rgb</span><span class="p">(</span><span class="n">double</span><span class="o">&amp;</span> <span class="n">R</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">G</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">B</span><span class="p">,</span> <span class="n">double</span> <span class="n">Y</span><span class="p">,</span> <span class="n">double</span> <span class="n">U</span><span class="p">,</span> <span class="n">double</span> <span class="n">V</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Y</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>
  <span class="n">U</span> <span class="o">-=</span> <span class="mi">128</span><span class="p">;</span>
  <span class="n">V</span> <span class="o">-=</span> <span class="mi">128</span><span class="p">;</span>
  <span class="n">R</span> <span class="o">=</span> <span class="mf">1.164</span> <span class="o">*</span> <span class="n">Y</span>             <span class="o">+</span> <span class="mf">1.596</span> <span class="o">*</span> <span class="n">V</span><span class="p">;</span>
  <span class="n">G</span> <span class="o">=</span> <span class="mf">1.164</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">-</span> <span class="mf">0.392</span> <span class="o">*</span> <span class="n">U</span> <span class="o">-</span> <span class="mf">0.813</span> <span class="o">*</span> <span class="n">V</span><span class="p">;</span>
  <span class="n">B</span> <span class="o">=</span> <span class="mf">1.164</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">+</span> <span class="mf">2.017</span> <span class="o">*</span> <span class="n">U</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在工程上，为提高性能，可以先用整数计算，再右移8位</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">rgb2yuv</span><span class="p">(</span><span class="n">double</span><span class="o">&amp;</span> <span class="n">Y</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">U</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">V</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">R</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">G</span><span class="p">,</span> <span class="n">const</span> <span class="n">double</span> <span class="n">B</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">((</span><span class="mi">66</span> <span class="o">*</span> <span class="n">R</span> <span class="o">+</span> <span class="mi">129</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="mi">25</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span><span class="p">;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">38</span> <span class="o">*</span> <span class="n">R</span> <span class="o">+</span> <span class="o">-</span><span class="mi">74</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="mi">112</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">128</span><span class="p">;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="p">((</span><span class="mi">112</span> <span class="o">*</span> <span class="n">R</span> <span class="o">+</span> <span class="o">-</span><span class="mi">94</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="o">-</span><span class="mi">18</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">128</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id19">参考资料</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/17892346/how-to-convert-rgb-yuv-rgb-both-ways">how to convert rgb yuv rgb both ways</a></p></li>
<li><p><a class="reference external" href="https://web.archive.org/web/20180423091842/http://www.equasys.de/colorconversion.html">Color Conversion from equasys</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="h264.html" class="btn btn-neutral float-right" title="H.264 编码" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="video_codec.html" class="btn btn-neutral float-left" title="视频编码" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, walter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>