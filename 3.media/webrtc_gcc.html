

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Google Congestion Control &mdash; webrtc_tutorial 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outline.html">目录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1.basic/index.html">1. WebRTC 基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.transport/index.html">2. WebRTC 传输</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">3. WebRTC 媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.tool/index.html">5. WebRTC 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6.misc/index.html">6. WebRTC 关联技术</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Google Congestion Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/3.media/webrtc_gcc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="google-congestion-control">
<h1>Google Congestion Control<a class="headerlink" href="#google-congestion-control" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>WebRTC RTP 拥塞控制</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>WIP</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2021-11-01</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id12">简介</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id13">1. 发送端控制器</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id14">2. 接收端控制器</a></p>
<ul>
<li><p><a class="reference internal" href="#arrival-time-filter" id="id15">1) 到达时间滤波器 arrival time filter</a></p></li>
<li><p><a class="reference internal" href="#the-over-use-detector" id="id16">2) 过度使用检测器 The over-use detector</a></p></li>
<li><p><a class="reference internal" href="#the-remote-state-region" id="id17">3) The remote state region</a></p></li>
<li><p><a class="reference internal" href="#remote-rate-controller" id="id18">4) Remote rate controller</a></p></li>
<li><p><a class="reference internal" href="#remb-processing" id="id19">5) REMB Processing</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id20">参考代码</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id21">参考资料</a></p></li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id12">简介</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>GCC <a class="footnote-reference brackets" href="#id8" id="id2">1</a> 拥塞控制算法根据估计的拥塞状态调节发送速率。 为了估计状态，GCC 采用了一种有限状态机，该状态机由通过比较测得的单向延迟变化与动态阈值而获得的信号驱动。</p>
<p>简而言之，当瓶颈被估计为“未充分利用 underused”时，发送速率就会增加； 当估计为“过度使用 overused”时，发送速率会降低。 当 GCC 流与 TCP 流共享瓶颈时，使用动态阈值来估计拥塞状态已成为解决饥饿问题的关键设计要求。</p>
<p>主要有两个算法:</p>
<ul class="simple">
<li><p>接收端控制器计算接收的比特率 <span class="math notranslate nohighlight">\(A_r\)</span>, 并将它发回给发送端</p></li>
<li><p>发送端控制器计算出不超过的 <span class="math notranslate nohighlight">\(A_r\)</span> 的目标发送比特率</p></li>
</ul>
<p>除了 RFC草案 <a class="reference external" href="https://datatracker.ietf.org/doc/html/draft-alvestrand-rmcat-congestion-03">A Google Congestion Control Algorithm for Real-Time Communication</a> 有详细阐述，在 IEEE 发布的文章 “Understanding the Dynamic Behaviour of the Google Congestion Control for RTCWeb” <a class="footnote-reference brackets" href="#id9" id="id3">2</a> 亦有所探讨。</p>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id13">1. 发送端控制器</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>发送端控制器是一种基于丢失的拥塞控制算法，它在每次 tk 第 k 个 RTCP 报告消息到达发送方或每次 tr 携带 Ar 的第 r 个 REMB 消息到达发送方时起作用。 RTCP 报告的发送频率是可变的，它取决于反向路径的可用带宽； 反向路径可用带宽越高，RTCP 报告频率越高。 REMB 格式是 RTCP 协议 [20] 的扩展，RMCAT WG 正在讨论该协议（另见第 III-B 节）。 RTCP 报告包括如 [20] 中所述计算的丢失数据包比例 fl(tk)。 发送方使用 fl(tk) 计算发送速率 As(tk)，以 kbps 为单位，根据以下等式：</p>
<div class="math notranslate nohighlight">
\[A_{s}(t_{k})=\cases{\max\{X(t_{k}), A_{s}(t_{k-1})(1-0.5f_{l}(t_{k}))\} &amp; $f_{l}(t_{k})&gt;0.1$\cr 1.05\ (\ A_{s}(t_{k-1})+\ 1{\rm kbps}) &amp; $f_{l}(t_{k})&lt;0.02$\cr A_{s}(t_{k-1}) &amp; ${\rm otherwise}$}\]</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id14">2. 接收端控制器</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>接收端控制器是一种基于延迟的拥塞控制算法，通过下面的公式来计算 <span class="math notranslate nohighlight">\(A_r\)</span></p>
<div class="math notranslate nohighlight">
\[A_{r}(t_{i})=\cases{\eta A_{r}(t_{i-1}) &amp; ${\rm Increase}$\cr \alpha R(t_{i}) &amp; ${\rm Decrease}$\cr A(t_{i-1}) &amp; ${\rm Hold}$}\]</div>
<div class="section" id="arrival-time-filter">
<h4><a class="toc-backref" href="#id15">1) 到达时间滤波器 arrival time filter</a><a class="headerlink" href="#arrival-time-filter" title="Permalink to this headline">¶</a></h4>
<p>两个包发送的间隔 T(i) – T(i-1) 和接收的间隔 t(i) – t(i-1) 在理想情况下是相同的，实际上会有不同.
也就是说包的到达时间并未保持稳定的速度。 在计算的时候可以用以帧分组，对两个组的到达时间进行计算。</p>
<div class="math notranslate nohighlight">
\[d(t_{i})={\triangle L(t_{i})\over C(t_{i})}+m(t_{i})+n(t_{i})\]</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># 发送间隔与到达时间之间的延时
d(i) = t(i) – t(i-1) – (T(i) – T(i-1))

# 两组包之间的大小之差
dL(i) = L(i) - l(i-1)

# C(i) 表示带宽
d(i) = dL(i)/C(i) + m(i) + v(i)
</pre></div>
</div>
<p>其中dL(i)表示相邻两帧的长度差，</p>
<ul>
<li><p>T(i)是第i个数据包组中第一个数据包的发送时间，</p></li>
<li><p>t(i)是第i个数据包组中最后一个数据包的到达时间</p></li>
<li><p>C(i)表示网络信道容量，</p></li>
<li><p>m(i)表示网络排队延迟，</p></li>
<li><p>v(i)表示网络抖动或其他延迟噪声。</p>
<blockquote>
<div><p>C(i) 是我们想预测的带宽，m(i)即是我们要求得的网络排队延迟, 可由 Kalman Filter 求得</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="the-over-use-detector">
<h4><a class="toc-backref" href="#id16">2) 过度使用检测器 The over-use detector</a><a class="headerlink" href="#the-over-use-detector" title="Permalink to this headline">¶</a></h4>
<p>Every time ti a video frame is received, the over-use detector produces a signal s that drives the state σ of the FSM (3) based on m(ti) and a threshold γ, The Algorithm 1 shows in details how s is generated: when m(ti)&gt;γ, the algorithm tracks the time spent in this condition by increasing the variable tOU of the frame inter-departure time △T. When tOU reaches t¯OU=100ms and m(ti)&gt; m(ti−1), the overuse signal is generated. On the other hand, if m(ti) decreases below γ, the underuse signal is generated, whereas the normal signal is triggered when −γ≤m(ti)≤γ.</p>
<p>每次接收到视频帧 <span class="math notranslate nohighlight">\(t_i\)</span> 时，过度使用检测器都会产生一个信号 s，该信号基于 <span class="math notranslate nohighlight">\(m(t_i)\)</span> 和阈值 <span class="math notranslate nohighlight">\(\gamma\)</span> 来驱动 FSM (下面的有限状态机) 的状态 <span class="math notranslate nohighlight">\(\sigma\)</span>，算法 1 详细显示了 s 是如何生成的 ：</p>
<p>当 <span class="math notranslate nohighlight">\(m(t_i) &gt; \gamma\)</span> 时，算法通过增加帧间隔时间 <span class="math notranslate nohighlight">\(\Delta T\)</span> 的变量 <span class="math notranslate nohighlight">\(t_{OU}\)</span> 来跟踪在这种情况下花费的时间。
当 <span class="math notranslate nohighlight">\(t_{OU}\)</span> 达到 <span class="math notranslate nohighlight">\(\bar{t}_{OU}=100ms\)</span> 且 <span class="math notranslate nohighlight">\(m(t_i) &gt; m(t_{i-1})\)</span> 时，产生过度使用信号。</p>
<p>另一方面，如果 <span class="math notranslate nohighlight">\(m(t_i)\)</span> 减小到 <span class="math notranslate nohighlight">\(\gamma\)</span> 以下，则产生未充分利用信号，而当 <span class="math notranslate nohighlight">\(-\gamma \leq m(t_i) \leq \gamma\)</span> 时触发正常信号。</p>
<div class="figure align-center" id="id10">
<a class="reference internal image-reference" href="../_images/rate-controller-fsm.gif"><img alt="remote rate controller finite state machine" src="../_images/rate-controller-fsm.gif" style="width: 495.0px; height: 142.20000000000002px;" /></a>
<p class="caption"><span class="caption-text">remote rate controller finite state machine</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>算法: Over-use Detector pseudo-code 过度使用检测器的伪代码</p></li>
</ul>
<div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="../_images/over-use-detector-pseudo-code.gif"><img alt="over-use detector pseudo code" src="../_images/over-use-detector-pseudo-code.gif" style="width: 438.3px; height: 495.0px;" /></a>
<p class="caption"><span class="caption-text">over-use detector pseudo code</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="the-remote-state-region">
<h4><a class="toc-backref" href="#id17">3) The remote state region</a><a class="headerlink" href="#the-remote-state-region" title="Permalink to this headline">¶</a></h4>
<p>This block computes the threshold γ as follows: by default γ=γ¯¯¯ with γ¯¯¯=25/60ms, however, when the system is considered to be close to the congestion, the threshold is halved, i.e. γ=γ¯¯¯/2. In particular, γ is halved when σ= decrease or when Ar is considerably lower that the incoming bitrate R(t).</p>
</div>
<div class="section" id="remote-rate-controller">
<h4><a class="toc-backref" href="#id18">4) Remote rate controller</a><a class="headerlink" href="#remote-rate-controller" title="Permalink to this headline">¶</a></h4>
<p>This block computes Ar according to (3) by using the signal s produced by the overuse detector, which drives the finite state machine shown in Figure 3.</p>
</div>
<div class="section" id="remb-processing">
<h4><a class="toc-backref" href="#id19">5) REMB Processing</a><a class="headerlink" href="#remb-processing" title="Permalink to this headline">¶</a></h4>
<p>This block notifies the sender with the computed rate Ar through REMB messages. The REMB messages are sent either every 1s, or immediately, if Ar(ti)&lt; 0.97Ar(ti−1), i.e. when Ar has decreased more than 3%.</p>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id20">参考代码</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/">https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/</a>
- congestion_controller/
- remote_bitrate_estimator/</p></li>
</ul>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id21">参考资料</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.cnblogs.com/wangyiyunxin/p/11122003.html">GCC Introduction</a></p></li>
</ul>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/draft-alvestrand-rmcat-congestion-03">A Google Congestion Control Algorithm for Real-Time Communication</a> （draft-alvestrand-rmcat-congestion-03）</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p><a class="reference external" href="https://ieeexplore.ieee.org/document/6691458">Understanding the Dynamic Behaviour of the Google Congestion Control for RTCWeb</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, walter.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>